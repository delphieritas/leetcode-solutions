A really good soulution can be found here

https://github.com/0x01f7/leetcode/blob/master/algorithms/subsets_ii.rb

which implemented in three line of code.
